---
id: E-plugin-foundation-and-settings
title: Plugin Foundation and Settings
status: done
priority: medium
parent: P-smarthole-client-obsidian
prerequisites: []
affectedFiles:
  package.json: "Created package.json with runtime dependency @anthropic-ai/sdk
    and dev dependencies for TypeScript/Obsidian development; Added dev
    dependencies: eslint ^9.39.2, @eslint/js ^9.39.2, typescript-eslint ^8.54.0,
    prettier ^3.8.1"
  tsconfig.json: Created TypeScript configuration with strict mode, ES2018 target,
    and source maps for Obsidian plugin development
  manifest.json: "Created Obsidian plugin manifest with isDesktopOnly: true for
    WebSocket support"
  esbuild.config.mjs: Created esbuild build configuration with ESM syntax, entry
    point src/main.ts, output main.js, external modules for Obsidian, watch mode
    for dev and minification for production
  mise.toml: "Created mise task runner configuration with all commands from
    CLAUDE.md: dev, build, test, quality, lint, format, type-check; Updated lint
    task to use ESLint 9 syntax (removed deprecated --ext flag)"
  eslint.config.mjs: Created ESLint flat config with typescript-eslint recommended
    rules, ignores for build output, and configured
    @typescript-eslint/no-unused-vars with argsIgnorePattern
  .prettierrc: Created Prettier config with semi, double quotes, 2-space tabs, es5
    trailing commas, and 100 char print width
  .prettierignore: Created Prettier ignore file excluding main.js, node_modules,
    reference-docs, docs, .trellis, and markdown files
  .gitignore: Created gitignore excluding node_modules, build output (main.js,
    main.js.map), IDE files, OS files, and logs
  src/main.ts: Created minimal plugin skeleton with SmartHolePlugin class
    extending Plugin, with onload() and onunload() lifecycle methods that log
    messages; Updated with settings property, loadSettings(), and saveSettings()
    methods; Added import for SmartHoleSettingTab and registered the settings
    tab in onload() using this.addSettingTab(); Added ConnectionStatus import,
    statusBarEl property, status bar initialization in onload(), click handler
    logging, and updateStatusBar() method with Record mapping all four
    connection states
  main.js: Generated by esbuild production build - minified bundled output
  src/types.ts: Created with ConnectionStatus type, CLAUDE_MODELS constant, and
    ClaudeModelId type
  src/settings.ts: "Created with SmartHoleSettings interface and DEFAULT_SETTINGS
    constant with default values from living spec; Added SmartHoleSettingTab
    class extending PluginSettingTab with display() method implementing all
    settings fields: SecretComponent for API key, dropdown for model selection,
    text input for client name, textareas for routing description and
    information architecture, and Generate button with MVP placeholder"
log:
  - "Auto-completed: All child features are complete"
schema: v1.0
childrenIds:
  - F-plugin-core-with-settings-and
  - F-project-scaffolding-and-build
created: 2026-02-03T03:39:44.221Z
updated: 2026-02-03T03:39:44.221Z
---

# Plugin Foundation and Settings

## Purpose and Goals

Establish the core Obsidian plugin infrastructure including project scaffolding, build configuration, plugin lifecycle management, and the complete settings UI. This epic creates the foundation that all other epics depend on.

## Major Components and Deliverables

### 1. Project Scaffolding
- `package.json` with dependencies (obsidian, typescript, esbuild, @anthropic-ai/sdk)
- `tsconfig.json` for TypeScript compilation
- `manifest.json` with plugin metadata (`isDesktopOnly: true`)
- Build scripts for development and production
- `.gitignore` and project structure

### 2. Main Plugin Class
- `src/main.ts` extending Obsidian's `Plugin` class
- `onload()` lifecycle hook for initialization
- `onunload()` lifecycle hook for cleanup
- Settings loading/saving infrastructure

### 3. Settings Interface and Tab
- `src/settings.ts` with `SmartHoleSettings` interface
- Settings tab UI using `PluginSettingTab`
- All settings fields:
  - API key (password field, stored securely)
  - Model selection dropdown (Haiku 4.5, Sonnet 4.5, Opus 4.5)
  - Client name text field (default: "Miss Simone")
  - Routing description textarea
  - Information architecture prompt textarea
  - "Generate description from IA" button
- Default values for all settings
- Validation for API key format

### 4. Model Configuration
Available models with API IDs:
| Model | API ID | Alias |
|-------|--------|-------|
| Claude Haiku 4.5 | `claude-haiku-4-5-20251001` | `claude-haiku-4-5` |
| Claude Sonnet 4.5 | `claude-sonnet-4-5-20250929` | `claude-sonnet-4-5` |
| Claude Opus 4.5 | `claude-opus-4-5-20251101` | `claude-opus-4-5` |

Default model: `claude-haiku-4-5-20251001` (fastest, most cost-efficient)

### 5. Status Bar Indicator
- Connection status display in Obsidian status bar
- States: disconnected, connecting, connected, error
- Click to show connection details or reconnect

## Acceptance Criteria

- [ ] Plugin loads successfully in Obsidian
- [ ] Plugin unloads cleanly without errors or leaked resources
- [ ] Settings tab displays all configuration options
- [ ] Settings persist across plugin reload
- [ ] API key field masks input
- [ ] Model dropdown shows Haiku 4.5, Sonnet 4.5, and Opus 4.5 options
- [ ] Default values applied on first load
- [ ] Status bar shows connection state
- [ ] Build produces valid `main.js` and `manifest.json`

## Technical Considerations

- Use `loadData()`/`saveData()` for settings persistence
- API key stored in plugin data (Obsidian's standard storage)
- Status bar uses `addStatusBarItem()` API
- Desktop-only plugin due to WebSocket requirement
- Follow Obsidian sample plugin patterns
- Use model aliases for flexibility, full IDs for production

## Dependencies

None - this is the foundational epic.

## Estimated Scale

2-3 features:
1. Project scaffolding and build setup
2. Main plugin class with settings infrastructure
3. Settings UI and status bar

## User Stories

- As a user, I can install and enable the plugin in Obsidian
- As a user, I can configure my Anthropic API key in settings
- As a user, I can choose which Claude model to use (Haiku, Sonnet, or Opus)
- As a user, I can customize the client name and routing description
- As a user, I can see the connection status at a glance

## Non-functional Requirements

- Plugin loads in under 100ms
- Settings save immediately on change
- Clean unload with no memory leaks